<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Lichat</title>
    <link rel="stylesheet" href="stylesheet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="lichat.js"></script>
  </head>
  <body>
    <div class="client">
      <nav>
        <section class="server" v-for="client in clients">
          <header>
            <img class="icon" v-bind:src="client.icon">
            <span class="name">{{client.name || client.servername}}</span>
            <nav>
              <a class="settings">
                <i class="fas fa-ellipsis-h"></i>
              </a>
            </nav>
          </header>
          <ul class="channels">
            <li class="channel" v-for="channel in client.channels"
                v-bind:class="{current: channel == currentChannel, update: 0 < channel.unread, alert: channel.alerted, primary: channel.isPrimary}"
                v-on:click="currentChannel = channel">
              <header>
                <img class="icon" v-bind:src="channel.icon">
                <span class="name">{{channel.name}}</span>
              </header>
              <div class="unread-count"
                   v-if="0 < channel.unread"
                   v-on:click="channel.unread = 0; channel.alerted = false">
                {{channel.unread}}
              </div>
            </li>
          </ul>
        </section>
      </nav>
      <div class="divider"></div>
      <main v-if="currentChannel">
        <header>
          <img class="icon" v-bind:src="currentChannel.icon">
          <span class="name">{{currentChannel.name}}</span>
          <span class="topic">{{currentChannel.topic}}</span>
          <nav>
            <a class="search" v-if="currentChannel.client.isAvailable('shirakumo-search')">
              <i class="fas fa-search"></i>
            </a>
            <a class="info">
              <i class="fas fa-info-circle"></i>
            </a>
            <a class="settings">
              <i class="fas fa-ellipsis-h"></i>
            </a>
          </nav>
        </header>
        <section class="output">
          <div class="message" v-for="message in currentChannel.messages"
               v-bind:class="{alert: message.isAlert}"
               v-bind:id="message.gid">
            <header>
              <time>{{message.time}}</time>
              <img class="icon" v-bind:src="message.author.icon">
              <span class="name" v-bind:class="{me: message.author == currentChannel.client.user}">{{message.author.name}}</span>
            </header>
            <a class="reply-to" v-if="message.replyTo" v-bind:href="message.replyTo.url">
              <span class="name" v-bind:class="{me: message.replyTo.author == currentChannel.client.user}">{{message.replyTo.author.name}}</span>
              <p>{{message.replyTo.shortText}}</p>
            </a>
            <div class="content">
              <img v-if="message.isImage" v-bind:src="message.text">
              <video controls v-else-if="message.isVideo">
                <source v-bind:src="message.text" v-bind:type="message.contentType">
              </video>
              <audio controls v-else-if="message.isAudio">
                <source v-bind:src="message.text" v-bind:type="message.contentType">
              </audio>
              <p v-else v-html="message.text"></p>
              <div class="reactions">
                <a class="reaction" v-for="reaction in message.reactions" v-bind:title="reaction.users.join(',')">
                  <i v-if="reaction.text">{{reaction.text}}</i>
                  <img v-else v-bind:src="reaction.image">
                  <span>{{reaction.count}}</span>
                </a>
              </div>
            </div>
            <nav>
              <a class="edit"
                 v-if="currentChannel.client.isAvailable('shirakumo-edit') && message.author.isSelf">
                <i class="fas fa-edit"></i>
              </a>
              <a class="reply"
                 v-if="currentChannel.client.isAvailable('shirakumo-replies')"
                 v-on:click="currentChannel.currentMessage.replyTo = message">
                <i class="fas fa-reply"></i>
              </a>
              <a class="react"
                 v-if="currentChannel.client.isAvailable('shirakumo-reactions')">
                <i class="fas fa-surprise"></i>
              </a>
              <a class="settings">
                <i class="fas fa-ellipsis-h"></i>
              </a>
            </nav>
          </div>
        </section>
        <footer>
          <div class="user me">
            <img class="icon" v-bind:src="currentChannel.client.user.icon">
          </div>
          <div class="content">
            <a class="reply-to" v-if="currentChannel.currentMessage.replyTo" v-on:click="currentChannel.currentMessage.replyTo = null">
              <span class="name" v-bind:class="{me: currentChannel.currentMessage.replyTo.author == currentChannel.client.user}">{{currentChannel.currentMessage.replyTo.author.name}}</span>
              <p>{{currentChannel.currentMessage.replyTo.shortText}}</p>
            </a>
            <textarea placeholder="Write something..." autofocus
                      v-model="currentChannel.currentMessage.text"
                      v-on:keyup.enter.prevent.stop="submit"></textarea>
          </div>
          <nav>
            <a class="emote">
              <i class="fas fa-smile"></i>
            </a>
            <a class="upload">
              <i class="fas fa-paperclip"></i>
            </a>
          </nav>
        </footer>
        </section>
    </div>
    <script>var lichat = new LichatUI();</script>
  </body>
</html>
