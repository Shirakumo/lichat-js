var allEmojis = [[0x1F600],[0x1F603],[0x1F604],[0x1F601],[0x1F606],[0x1F605],[0x1F923],[0x1F602],[0x1F642],[0x1F643],[0x1F609],[0x1F60A],[0x1F607],[0x1F970],[0x1F60D],[0x1F929],[0x1F618],[0x1F617],[0x263A],[0x1F61A],[0x1F619],[0x1F972],[0x1F60B],[0x1F61B],[0x1F61C],[0x1F92A],[0x1F61D],[0x1F911],[0x1F917],[0x1F92D],[0x1F92B],[0x1F914],[0x1F910],[0x1F928],[0x1F610],[0x1F611],[0x1F636],[0x1F636,0x200D,0x1F32B,0xFE0F],[0x1F60F],[0x1F612],[0x1F644],[0x1F62C],[0x1F62E,0x200D,0x1F4A8],[0x1F925],[0x1F60C],[0x1F614],[0x1F62A],[0x1F924],[0x1F634],[0x1F637],[0x1F912],[0x1F915],[0x1F922],[0x1F92E],[0x1F927],[0x1F975],[0x1F976],[0x1F974],[0x1F635],[0x1F635,0x200D,0x1F4AB],[0x1F92F],[0x1F920],[0x1F973],[0x1F978],[0x1F60E],[0x1F913],[0x1F9D0],[0x1F615],[0x1F61F],[0x1F641],[0x2639],[0x1F62E],[0x1F62F],[0x1F632],[0x1F633],[0x1F97A],[0x1F626],[0x1F627],[0x1F628],[0x1F630],[0x1F625],[0x1F622],[0x1F62D],[0x1F631],[0x1F616],[0x1F623],[0x1F61E],[0x1F613],[0x1F629],[0x1F62B],[0x1F971],[0x1F624],[0x1F621],[0x1F620],[0x1F92C],[0x1F608],[0x1F47F],[0x1F480],[0x2620],[0x1F4A9],[0x1F921],[0x1F479],[0x1F47A],[0x1F47B],[0x1F47D],[0x1F47E],[0x1F916],[0x1F63A],[0x1F638],[0x1F639],[0x1F63B],[0x1F63C],[0x1F63D],[0x1F640],[0x1F63F],[0x1F63E],[0x1F648],[0x1F649],[0x1F64A],[0x1F48B],[0x1F48C],[0x1F498],[0x1F49D],[0x1F496],[0x1F497],[0x1F493],[0x1F49E],[0x1F495],[0x1F49F],[0x2763],[0x1F494],[0x2764,0xFE0F,0x200D,0x1F525],[0x2764,0xFE0F,0x200D,0x1FA79],[0x2764],[0x1F9E1],[0x1F49B],[0x1F49A],[0x1F499],[0x1F49C],[0x1F90E],[0x1F5A4],[0x1F90D],[0x1F4AF],[0x1F4A2],[0x1F4A5],[0x1F4AB],[0x1F4A6],[0x1F4A8],[0x1F573],[0x1F4A3],[0x1F4AC],[0x1F441,0xFE0F,0x200D,0x1F5E8,0xFE0F],[0x1F5E8],[0x1F5EF],[0x1F4AD],[0x1F4A4],[0x1F44B],[0x1F91A],[0x1F590],[0x270B],[0x1F596],[0x1F44C],[0x1F90C],[0x1F90F],[0x270C],[0x1F91E],[0x1F91F],[0x1F918],[0x1F919],[0x1F448],[0x1F449],[0x1F446],[0x1F595],[0x1F447],[0x261D],[0x1F44D],[0x1F44E],[0x270A],[0x1F44A],[0x1F91B],[0x1F91C],[0x1F44F],[0x1F64C],[0x1F450],[0x1F932],[0x1F91D],[0x1F64F],[0x270D],[0x1F485],[0x1F933],[0x1F4AA],[0x1F9BE],[0x1F9BF],[0x1F9B5],[0x1F9B6],[0x1F442],[0x1F9BB],[0x1F443],[0x1F9E0],[0x1FAC0],[0x1FAC1],[0x1F9B7],[0x1F9B4],[0x1F440],[0x1F441],[0x1F445],[0x1F444],[0x1F476],[0x1F9D2],[0x1F466],[0x1F467],[0x1F9D1],[0x1F471],[0x1F468],[0x1F9D4],[0x1F9D4,0x200D,0x2642,0xFE0F],[0x1F9D4,0x200D,0x2640,0xFE0F],[0x1F468,0x200D,0x1F9B0],[0x1F468,0x200D,0x1F9B1],[0x1F468,0x200D,0x1F9B3],[0x1F468,0x200D,0x1F9B2],[0x1F469],[0x1F469,0x200D,0x1F9B0],[0x1F9D1,0x200D,0x1F9B0],[0x1F469,0x200D,0x1F9B1],[0x1F9D1,0x200D,0x1F9B1],[0x1F469,0x200D,0x1F9B3],[0x1F9D1,0x200D,0x1F9B3],[0x1F469,0x200D,0x1F9B2],[0x1F9D1,0x200D,0x1F9B2],[0x1F471,0x200D,0x2640,0xFE0F],[0x1F471,0x200D,0x2642,0xFE0F],[0x1F9D3],[0x1F474],[0x1F475],[0x1F64D],[0x1F64D,0x200D,0x2642,0xFE0F],[0x1F64D,0x200D,0x2640,0xFE0F],[0x1F64E],[0x1F64E,0x200D,0x2642,0xFE0F],[0x1F64E,0x200D,0x2640,0xFE0F],[0x1F645],[0x1F645,0x200D,0x2642,0xFE0F],[0x1F645,0x200D,0x2640,0xFE0F],[0x1F646],[0x1F646,0x200D,0x2642,0xFE0F],[0x1F646,0x200D,0x2640,0xFE0F],[0x1F481],[0x1F481,0x200D,0x2642,0xFE0F],[0x1F481,0x200D,0x2640,0xFE0F],[0x1F64B],[0x1F64B,0x200D,0x2642,0xFE0F],[0x1F64B,0x200D,0x2640,0xFE0F],[0x1F9CF],[0x1F9CF,0x200D,0x2642,0xFE0F],[0x1F9CF,0x200D,0x2640,0xFE0F],[0x1F647],[0x1F647,0x200D,0x2642,0xFE0F],[0x1F647,0x200D,0x2640,0xFE0F],[0x1F926],[0x1F926,0x200D,0x2642,0xFE0F],[0x1F926,0x200D,0x2640,0xFE0F],[0x1F937],[0x1F937,0x200D,0x2642,0xFE0F],[0x1F937,0x200D,0x2640,0xFE0F],[0x1F9D1,0x200D,0x2695,0xFE0F],[0x1F468,0x200D,0x2695,0xFE0F],[0x1F469,0x200D,0x2695,0xFE0F],[0x1F9D1,0x200D,0x1F393],[0x1F468,0x200D,0x1F393],[0x1F469,0x200D,0x1F393],[0x1F9D1,0x200D,0x1F3EB],[0x1F468,0x200D,0x1F3EB],[0x1F469,0x200D,0x1F3EB],[0x1F9D1,0x200D,0x2696,0xFE0F],[0x1F468,0x200D,0x2696,0xFE0F],[0x1F469,0x200D,0x2696,0xFE0F],[0x1F9D1,0x200D,0x1F33E],[0x1F468,0x200D,0x1F33E],[0x1F469,0x200D,0x1F33E],[0x1F9D1,0x200D,0x1F373],[0x1F468,0x200D,0x1F373],[0x1F469,0x200D,0x1F373],[0x1F9D1,0x200D,0x1F527],[0x1F468,0x200D,0x1F527],[0x1F469,0x200D,0x1F527],[0x1F9D1,0x200D,0x1F3ED],[0x1F468,0x200D,0x1F3ED],[0x1F469,0x200D,0x1F3ED],[0x1F9D1,0x200D,0x1F4BC],[0x1F468,0x200D,0x1F4BC],[0x1F469,0x200D,0x1F4BC],[0x1F9D1,0x200D,0x1F52C],[0x1F468,0x200D,0x1F52C],[0x1F469,0x200D,0x1F52C],[0x1F9D1,0x200D,0x1F4BB],[0x1F468,0x200D,0x1F4BB],[0x1F469,0x200D,0x1F4BB],[0x1F9D1,0x200D,0x1F3A4],[0x1F468,0x200D,0x1F3A4],[0x1F469,0x200D,0x1F3A4],[0x1F9D1,0x200D,0x1F3A8],[0x1F468,0x200D,0x1F3A8],[0x1F469,0x200D,0x1F3A8],[0x1F9D1,0x200D,0x2708,0xFE0F],[0x1F468,0x200D,0x2708,0xFE0F],[0x1F469,0x200D,0x2708,0xFE0F],[0x1F9D1,0x200D,0x1F680],[0x1F468,0x200D,0x1F680],[0x1F469,0x200D,0x1F680],[0x1F9D1,0x200D,0x1F692],[0x1F468,0x200D,0x1F692],[0x1F469,0x200D,0x1F692],[0x1F46E],[0x1F46E,0x200D,0x2642,0xFE0F],[0x1F46E,0x200D,0x2640,0xFE0F],[0x1F575],[0x1F575,0xFE0F,0x200D,0x2642,0xFE0F],[0x1F575,0xFE0F,0x200D,0x2640,0xFE0F],[0x1F482],[0x1F482,0x200D,0x2642,0xFE0F],[0x1F482,0x200D,0x2640,0xFE0F],[0x1F977],[0x1F477],[0x1F477,0x200D,0x2642,0xFE0F],[0x1F477,0x200D,0x2640,0xFE0F],[0x1F934],[0x1F478],[0x1F473],[0x1F473,0x200D,0x2642,0xFE0F],[0x1F473,0x200D,0x2640,0xFE0F],[0x1F472],[0x1F9D5],[0x1F935],[0x1F935,0x200D,0x2642,0xFE0F],[0x1F935,0x200D,0x2640,0xFE0F],[0x1F470],[0x1F470,0x200D,0x2642,0xFE0F],[0x1F470,0x200D,0x2640,0xFE0F],[0x1F930],[0x1F931],[0x1F469,0x200D,0x1F37C],[0x1F468,0x200D,0x1F37C],[0x1F9D1,0x200D,0x1F37C],[0x1F47C],[0x1F385],[0x1F936],[0x1F9D1,0x200D,0x1F384],[0x1F9B8],[0x1F9B8,0x200D,0x2642,0xFE0F],[0x1F9B8,0x200D,0x2640,0xFE0F],[0x1F9B9],[0x1F9B9,0x200D,0x2642,0xFE0F],[0x1F9B9,0x200D,0x2640,0xFE0F],[0x1F9D9],[0x1F9D9,0x200D,0x2642,0xFE0F],[0x1F9D9,0x200D,0x2640,0xFE0F],[0x1F9DA],[0x1F9DA,0x200D,0x2642,0xFE0F],[0x1F9DA,0x200D,0x2640,0xFE0F],[0x1F9DB],[0x1F9DB,0x200D,0x2642,0xFE0F],[0x1F9DB,0x200D,0x2640,0xFE0F],[0x1F9DC],[0x1F9DC,0x200D,0x2642,0xFE0F],[0x1F9DC,0x200D,0x2640,0xFE0F],[0x1F9DD],[0x1F9DD,0x200D,0x2642,0xFE0F],[0x1F9DD,0x200D,0x2640,0xFE0F],[0x1F9DE],[0x1F9DE,0x200D,0x2642,0xFE0F],[0x1F9DE,0x200D,0x2640,0xFE0F],[0x1F9DF],[0x1F9DF,0x200D,0x2642,0xFE0F],[0x1F9DF,0x200D,0x2640,0xFE0F],[0x1F486],[0x1F486,0x200D,0x2642,0xFE0F],[0x1F486,0x200D,0x2640,0xFE0F],[0x1F487],[0x1F487,0x200D,0x2642,0xFE0F],[0x1F487,0x200D,0x2640,0xFE0F],[0x1F6B6],[0x1F6B6,0x200D,0x2642,0xFE0F],[0x1F6B6,0x200D,0x2640,0xFE0F],[0x1F9CD],[0x1F9CD,0x200D,0x2642,0xFE0F],[0x1F9CD,0x200D,0x2640,0xFE0F],[0x1F9CE],[0x1F9CE,0x200D,0x2642,0xFE0F],[0x1F9CE,0x200D,0x2640,0xFE0F],[0x1F9D1,0x200D,0x1F9AF],[0x1F468,0x200D,0x1F9AF],[0x1F469,0x200D,0x1F9AF],[0x1F9D1,0x200D,0x1F9BC],[0x1F468,0x200D,0x1F9BC],[0x1F469,0x200D,0x1F9BC],[0x1F9D1,0x200D,0x1F9BD],[0x1F468,0x200D,0x1F9BD],[0x1F469,0x200D,0x1F9BD],[0x1F3C3],[0x1F3C3,0x200D,0x2642,0xFE0F],[0x1F3C3,0x200D,0x2640,0xFE0F],[0x1F483],[0x1F57A],[0x1F574],[0x1F46F],[0x1F46F,0x200D,0x2642,0xFE0F],[0x1F46F,0x200D,0x2640,0xFE0F],[0x1F9D6],[0x1F9D6,0x200D,0x2642,0xFE0F],[0x1F9D6,0x200D,0x2640,0xFE0F],[0x1F9D7],[0x1F9D7,0x200D,0x2642,0xFE0F],[0x1F9D7,0x200D,0x2640,0xFE0F],[0x1F93A],[0x1F3C7],[0x26F7],[0x1F3C2],[0x1F3CC],[0x1F3CC,0xFE0F,0x200D,0x2642,0xFE0F],[0x1F3CC,0xFE0F,0x200D,0x2640,0xFE0F],[0x1F3C4],[0x1F3C4,0x200D,0x2642,0xFE0F],[0x1F3C4,0x200D,0x2640,0xFE0F],[0x1F6A3],[0x1F6A3,0x200D,0x2642,0xFE0F],[0x1F6A3,0x200D,0x2640,0xFE0F],[0x1F3CA],[0x1F3CA,0x200D,0x2642,0xFE0F],[0x1F3CA,0x200D,0x2640,0xFE0F],[0x26F9],[0x26F9,0xFE0F,0x200D,0x2642,0xFE0F],[0x26F9,0xFE0F,0x200D,0x2640,0xFE0F],[0x1F3CB],[0x1F3CB,0xFE0F,0x200D,0x2642,0xFE0F],[0x1F3CB,0xFE0F,0x200D,0x2640,0xFE0F],[0x1F6B4],[0x1F6B4,0x200D,0x2642,0xFE0F],[0x1F6B4,0x200D,0x2640,0xFE0F],[0x1F6B5],[0x1F6B5,0x200D,0x2642,0xFE0F],[0x1F6B5,0x200D,0x2640,0xFE0F],[0x1F938],[0x1F938,0x200D,0x2642,0xFE0F],[0x1F938,0x200D,0x2640,0xFE0F],[0x1F93C],[0x1F93C,0x200D,0x2642,0xFE0F],[0x1F93C,0x200D,0x2640,0xFE0F],[0x1F93D],[0x1F93D,0x200D,0x2642,0xFE0F],[0x1F93D,0x200D,0x2640,0xFE0F],[0x1F93E],[0x1F93E,0x200D,0x2642,0xFE0F],[0x1F93E,0x200D,0x2640,0xFE0F],[0x1F939],[0x1F939,0x200D,0x2642,0xFE0F],[0x1F939,0x200D,0x2640,0xFE0F],[0x1F9D8],[0x1F9D8,0x200D,0x2642,0xFE0F],[0x1F9D8,0x200D,0x2640,0xFE0F],[0x1F6C0],[0x1F6CC],[0x1F9D1,0x200D,0x1F91D,0x200D,0x1F9D1],[0x1F46D],[0x1F46B],[0x1F46C],[0x1F48F],[0x1F469,0x200D,0x2764,0xFE0F,0x200D,0x1F48B,0x200D,0x1F468],[0x1F468,0x200D,0x2764,0xFE0F,0x200D,0x1F48B,0x200D,0x1F468],[0x1F469,0x200D,0x2764,0xFE0F,0x200D,0x1F48B,0x200D,0x1F469],[0x1F491],[0x1F469,0x200D,0x2764,0xFE0F,0x200D,0x1F468],[0x1F468,0x200D,0x2764,0xFE0F,0x200D,0x1F468],[0x1F469,0x200D,0x2764,0xFE0F,0x200D,0x1F469],[0x1F46A],[0x1F468,0x200D,0x1F469,0x200D,0x1F466],[0x1F468,0x200D,0x1F469,0x200D,0x1F467],[0x1F468,0x200D,0x1F469,0x200D,0x1F467,0x200D,0x1F466],[0x1F468,0x200D,0x1F469,0x200D,0x1F466,0x200D,0x1F466],[0x1F468,0x200D,0x1F469,0x200D,0x1F467,0x200D,0x1F467],[0x1F468,0x200D,0x1F468,0x200D,0x1F466],[0x1F468,0x200D,0x1F468,0x200D,0x1F467],[0x1F468,0x200D,0x1F468,0x200D,0x1F467,0x200D,0x1F466],[0x1F468,0x200D,0x1F468,0x200D,0x1F466,0x200D,0x1F466],[0x1F468,0x200D,0x1F468,0x200D,0x1F467,0x200D,0x1F467],[0x1F469,0x200D,0x1F469,0x200D,0x1F466],[0x1F469,0x200D,0x1F469,0x200D,0x1F467],[0x1F469,0x200D,0x1F469,0x200D,0x1F467,0x200D,0x1F466],[0x1F469,0x200D,0x1F469,0x200D,0x1F466,0x200D,0x1F466],[0x1F469,0x200D,0x1F469,0x200D,0x1F467,0x200D,0x1F467],[0x1F468,0x200D,0x1F466],[0x1F468,0x200D,0x1F466,0x200D,0x1F466],[0x1F468,0x200D,0x1F467],[0x1F468,0x200D,0x1F467,0x200D,0x1F466],[0x1F468,0x200D,0x1F467,0x200D,0x1F467],[0x1F469,0x200D,0x1F466],[0x1F469,0x200D,0x1F466,0x200D,0x1F466],[0x1F469,0x200D,0x1F467],[0x1F469,0x200D,0x1F467,0x200D,0x1F466],[0x1F469,0x200D,0x1F467,0x200D,0x1F467],[0x1F5E3],[0x1F464],[0x1F465],[0x1FAC2],[0x1F463],[0x1F9B0],[0x1F9B1],[0x1F9B3],[0x1F9B2],[0x1F435],[0x1F412],[0x1F98D],[0x1F9A7],[0x1F436],[0x1F415],[0x1F9AE],[0x1F415,0x200D,0x1F9BA],[0x1F429],[0x1F43A],[0x1F98A],[0x1F99D],[0x1F431],[0x1F408],[0x1F408,0x200D,0x2B1B],[0x1F981],[0x1F42F],[0x1F405],[0x1F406],[0x1F434],[0x1F40E],[0x1F984],[0x1F993],[0x1F98C],[0x1F9AC],[0x1F42E],[0x1F402],[0x1F403],[0x1F404],[0x1F437],[0x1F416],[0x1F417],[0x1F43D],[0x1F40F],[0x1F411],[0x1F410],[0x1F42A],[0x1F42B],[0x1F999],[0x1F992],[0x1F418],[0x1F9A3],[0x1F98F],[0x1F99B],[0x1F42D],[0x1F401],[0x1F400],[0x1F439],[0x1F430],[0x1F407],[0x1F43F],[0x1F9AB],[0x1F994],[0x1F987],[0x1F43B],[0x1F43B,0x200D,0x2744,0xFE0F],[0x1F428],[0x1F43C],[0x1F9A5],[0x1F9A6],[0x1F9A8],[0x1F998],[0x1F9A1],[0x1F43E],[0x1F983],[0x1F414],[0x1F413],[0x1F423],[0x1F424],[0x1F425],[0x1F426],[0x1F427],[0x1F54A],[0x1F985],[0x1F986],[0x1F9A2],[0x1F989],[0x1F9A4],[0x1FAB6],[0x1F9A9],[0x1F99A],[0x1F99C],[0x1F438],[0x1F40A],[0x1F422],[0x1F98E],[0x1F40D],[0x1F432],[0x1F409],[0x1F995],[0x1F996],[0x1F433],[0x1F40B],[0x1F42C],[0x1F9AD],[0x1F41F],[0x1F420],[0x1F421],[0x1F988],[0x1F419],[0x1F41A],[0x1F40C],[0x1F98B],[0x1F41B],[0x1F41C],[0x1F41D],[0x1FAB2],[0x1F41E],[0x1F997],[0x1FAB3],[0x1F577],[0x1F578],[0x1F982],[0x1F99F],[0x1FAB0],[0x1FAB1],[0x1F9A0],[0x1F490],[0x1F338],[0x1F4AE],[0x1F3F5],[0x1F339],[0x1F940],[0x1F33A],[0x1F33B],[0x1F33C],[0x1F337],[0x1F331],[0x1FAB4],[0x1F332],[0x1F333],[0x1F334],[0x1F335],[0x1F33E],[0x1F33F],[0x2618],[0x1F340],[0x1F341],[0x1F342],[0x1F343],[0x1F347],[0x1F348],[0x1F349],[0x1F34A],[0x1F34B],[0x1F34C],[0x1F34D],[0x1F96D],[0x1F34E],[0x1F34F],[0x1F350],[0x1F351],[0x1F352],[0x1F353],[0x1FAD0],[0x1F95D],[0x1F345],[0x1FAD2],[0x1F965],[0x1F951],[0x1F346],[0x1F954],[0x1F955],[0x1F33D],[0x1F336],[0x1FAD1],[0x1F952],[0x1F96C],[0x1F966],[0x1F9C4],[0x1F9C5],[0x1F344],[0x1F95C],[0x1F330],[0x1F35E],[0x1F950],[0x1F956],[0x1FAD3],[0x1F968],[0x1F96F],[0x1F95E],[0x1F9C7],[0x1F9C0],[0x1F356],[0x1F357],[0x1F969],[0x1F953],[0x1F354],[0x1F35F],[0x1F355],[0x1F32D],[0x1F96A],[0x1F32E],[0x1F32F],[0x1FAD4],[0x1F959],[0x1F9C6],[0x1F95A],[0x1F373],[0x1F958],[0x1F372],[0x1FAD5],[0x1F963],[0x1F957],[0x1F37F],[0x1F9C8],[0x1F9C2],[0x1F96B],[0x1F371],[0x1F358],[0x1F359],[0x1F35A],[0x1F35B],[0x1F35C],[0x1F35D],[0x1F360],[0x1F362],[0x1F363],[0x1F364],[0x1F365],[0x1F96E],[0x1F361],[0x1F95F],[0x1F960],[0x1F961],[0x1F980],[0x1F99E],[0x1F990],[0x1F991],[0x1F9AA],[0x1F366],[0x1F367],[0x1F368],[0x1F369],[0x1F36A],[0x1F382],[0x1F370],[0x1F9C1],[0x1F967],[0x1F36B],[0x1F36C],[0x1F36D],[0x1F36E],[0x1F36F],[0x1F37C],[0x1F95B],[0x2615],[0x1FAD6],[0x1F375],[0x1F376],[0x1F37E],[0x1F377],[0x1F378],[0x1F379],[0x1F37A],[0x1F37B],[0x1F942],[0x1F943],[0x1F964],[0x1F9CB],[0x1F9C3],[0x1F9C9],[0x1F9CA],[0x1F962],[0x1F37D],[0x1F374],[0x1F944],[0x1F52A],[0x1F3FA],[0x1F30D],[0x1F30E],[0x1F30F],[0x1F310],[0x1F5FA],[0x1F5FE],[0x1F9ED],[0x1F3D4],[0x26F0],[0x1F30B],[0x1F5FB],[0x1F3D5],[0x1F3D6],[0x1F3DC],[0x1F3DD],[0x1F3DE],[0x1F3DF],[0x1F3DB],[0x1F3D7],[0x1F9F1],[0x1FAA8],[0x1FAB5],[0x1F6D6],[0x1F3D8],[0x1F3DA],[0x1F3E0],[0x1F3E1],[0x1F3E2],[0x1F3E3],[0x1F3E4],[0x1F3E5],[0x1F3E6],[0x1F3E8],[0x1F3E9],[0x1F3EA],[0x1F3EB],[0x1F3EC],[0x1F3ED],[0x1F3EF],[0x1F3F0],[0x1F492],[0x1F5FC],[0x1F5FD],[0x26EA],[0x1F54C],[0x1F6D5],[0x1F54D],[0x26E9],[0x1F54B],[0x26F2],[0x26FA],[0x1F301],[0x1F303],[0x1F3D9],[0x1F304],[0x1F305],[0x1F306],[0x1F307],[0x1F309],[0x2668],[0x1F3A0],[0x1F3A1],[0x1F3A2],[0x1F488],[0x1F3AA],[0x1F682],[0x1F683],[0x1F684],[0x1F685],[0x1F686],[0x1F687],[0x1F688],[0x1F689],[0x1F68A],[0x1F69D],[0x1F69E],[0x1F68B],[0x1F68C],[0x1F68D],[0x1F68E],[0x1F690],[0x1F691],[0x1F692],[0x1F693],[0x1F694],[0x1F695],[0x1F696],[0x1F697],[0x1F698],[0x1F699],[0x1F6FB],[0x1F69A],[0x1F69B],[0x1F69C],[0x1F3CE],[0x1F3CD],[0x1F6F5],[0x1F9BD],[0x1F9BC],[0x1F6FA],[0x1F6B2],[0x1F6F4],[0x1F6F9],[0x1F6FC],[0x1F68F],[0x1F6E3],[0x1F6E4],[0x1F6E2],[0x26FD],[0x1F6A8],[0x1F6A5],[0x1F6A6],[0x1F6D1],[0x1F6A7],[0x2693],[0x26F5],[0x1F6F6],[0x1F6A4],[0x1F6F3],[0x26F4],[0x1F6E5],[0x1F6A2],[0x2708],[0x1F6E9],[0x1F6EB],[0x1F6EC],[0x1FA82],[0x1F4BA],[0x1F681],[0x1F69F],[0x1F6A0],[0x1F6A1],[0x1F6F0],[0x1F680],[0x1F6F8],[0x1F6CE],[0x1F9F3],[0x231B],[0x23F3],[0x231A],[0x23F0],[0x23F1],[0x23F2],[0x1F570],[0x1F55B],[0x1F567],[0x1F550],[0x1F55C],[0x1F551],[0x1F55D],[0x1F552],[0x1F55E],[0x1F553],[0x1F55F],[0x1F554],[0x1F560],[0x1F555],[0x1F561],[0x1F556],[0x1F562],[0x1F557],[0x1F563],[0x1F558],[0x1F564],[0x1F559],[0x1F565],[0x1F55A],[0x1F566],[0x1F311],[0x1F312],[0x1F313],[0x1F314],[0x1F315],[0x1F316],[0x1F317],[0x1F318],[0x1F319],[0x1F31A],[0x1F31B],[0x1F31C],[0x1F321],[0x2600],[0x1F31D],[0x1F31E],[0x1FA90],[0x2B50],[0x1F31F],[0x1F320],[0x1F30C],[0x2601],[0x26C5],[0x26C8],[0x1F324],[0x1F325],[0x1F326],[0x1F327],[0x1F328],[0x1F329],[0x1F32A],[0x1F32B],[0x1F32C],[0x1F300],[0x1F308],[0x1F302],[0x2602],[0x2614],[0x26F1],[0x26A1],[0x2744],[0x2603],[0x26C4],[0x2604],[0x1F525],[0x1F4A7],[0x1F30A],[0x1F383],[0x1F384],[0x1F386],[0x1F387],[0x1F9E8],[0x2728],[0x1F388],[0x1F389],[0x1F38A],[0x1F38B],[0x1F38D],[0x1F38E],[0x1F38F],[0x1F390],[0x1F391],[0x1F9E7],[0x1F380],[0x1F381],[0x1F397],[0x1F39F],[0x1F3AB],[0x1F396],[0x1F3C6],[0x1F3C5],[0x1F947],[0x1F948],[0x1F949],[0x26BD],[0x26BE],[0x1F94E],[0x1F3C0],[0x1F3D0],[0x1F3C8],[0x1F3C9],[0x1F3BE],[0x1F94F],[0x1F3B3],[0x1F3CF],[0x1F3D1],[0x1F3D2],[0x1F94D],[0x1F3D3],[0x1F3F8],[0x1F94A],[0x1F94B],[0x1F945],[0x26F3],[0x26F8],[0x1F3A3],[0x1F93F],[0x1F3BD],[0x1F3BF],[0x1F6F7],[0x1F94C],[0x1F3AF],[0x1FA80],[0x1FA81],[0x1F3B1],[0x1F52E],[0x1FA84],[0x1F9FF],[0x1F3AE],[0x1F579],[0x1F3B0],[0x1F3B2],[0x1F9E9],[0x1F9F8],[0x1FA85],[0x1FA86],[0x2660],[0x2665],[0x2666],[0x2663],[0x265F],[0x1F0CF],[0x1F004],[0x1F3B4],[0x1F3AD],[0x1F5BC],[0x1F3A8],[0x1F9F5],[0x1FAA1],[0x1F9F6],[0x1FAA2],[0x1F453],[0x1F576],[0x1F97D],[0x1F97C],[0x1F9BA],[0x1F454],[0x1F455],[0x1F456],[0x1F9E3],[0x1F9E4],[0x1F9E5],[0x1F9E6],[0x1F457],[0x1F458],[0x1F97B],[0x1FA71],[0x1FA72],[0x1FA73],[0x1F459],[0x1F45A],[0x1F45B],[0x1F45C],[0x1F45D],[0x1F6CD],[0x1F392],[0x1FA74],[0x1F45E],[0x1F45F],[0x1F97E],[0x1F97F],[0x1F460],[0x1F461],[0x1FA70],[0x1F462],[0x1F451],[0x1F452],[0x1F3A9],[0x1F393],[0x1F9E2],[0x1FA96],[0x26D1],[0x1F4FF],[0x1F484],[0x1F48D],[0x1F48E],[0x1F507],[0x1F508],[0x1F509],[0x1F50A],[0x1F4E2],[0x1F4E3],[0x1F4EF],[0x1F514],[0x1F515],[0x1F3BC],[0x1F3B5],[0x1F3B6],[0x1F399],[0x1F39A],[0x1F39B],[0x1F3A4],[0x1F3A7],[0x1F4FB],[0x1F3B7],[0x1FA97],[0x1F3B8],[0x1F3B9],[0x1F3BA],[0x1F3BB],[0x1FA95],[0x1F941],[0x1FA98],[0x1F4F1],[0x1F4F2],[0x260E],[0x1F4DE],[0x1F4DF],[0x1F4E0],[0x1F50B],[0x1F50C],[0x1F4BB],[0x1F5A5],[0x1F5A8],[0x2328],[0x1F5B1],[0x1F5B2],[0x1F4BD],[0x1F4BE],[0x1F4BF],[0x1F4C0],[0x1F9EE],[0x1F3A5],[0x1F39E],[0x1F4FD],[0x1F3AC],[0x1F4FA],[0x1F4F7],[0x1F4F8],[0x1F4F9],[0x1F4FC],[0x1F50D],[0x1F50E],[0x1F56F],[0x1F4A1],[0x1F526],[0x1F3EE],[0x1FA94],[0x1F4D4],[0x1F4D5],[0x1F4D6],[0x1F4D7],[0x1F4D8],[0x1F4D9],[0x1F4DA],[0x1F4D3],[0x1F4D2],[0x1F4C3],[0x1F4DC],[0x1F4C4],[0x1F4F0],[0x1F5DE],[0x1F4D1],[0x1F516],[0x1F3F7],[0x1F4B0],[0x1FA99],[0x1F4B4],[0x1F4B5],[0x1F4B6],[0x1F4B7],[0x1F4B8],[0x1F4B3],[0x1F9FE],[0x1F4B9],[0x2709],[0x1F4E7],[0x1F4E8],[0x1F4E9],[0x1F4E4],[0x1F4E5],[0x1F4E6],[0x1F4EB],[0x1F4EA],[0x1F4EC],[0x1F4ED],[0x1F4EE],[0x1F5F3],[0x270F],[0x2712],[0x1F58B],[0x1F58A],[0x1F58C],[0x1F58D],[0x1F4DD],[0x1F4BC],[0x1F4C1],[0x1F4C2],[0x1F5C2],[0x1F4C5],[0x1F4C6],[0x1F5D2],[0x1F5D3],[0x1F4C7],[0x1F4C8],[0x1F4C9],[0x1F4CA],[0x1F4CB],[0x1F4CC],[0x1F4CD],[0x1F4CE],[0x1F587],[0x1F4CF],[0x1F4D0],[0x2702],[0x1F5C3],[0x1F5C4],[0x1F5D1],[0x1F512],[0x1F513],[0x1F50F],[0x1F510],[0x1F511],[0x1F5DD],[0x1F528],[0x1FA93],[0x26CF],[0x2692],[0x1F6E0],[0x1F5E1],[0x2694],[0x1F52B],[0x1FA83],[0x1F3F9],[0x1F6E1],[0x1FA9A],[0x1F527],[0x1FA9B],[0x1F529],[0x2699],[0x1F5DC],[0x2696],[0x1F9AF],[0x1F517],[0x26D3],[0x1FA9D],[0x1F9F0],[0x1F9F2],[0x1FA9C],[0x2697],[0x1F9EA],[0x1F9EB],[0x1F9EC],[0x1F52C],[0x1F52D],[0x1F4E1],[0x1F489],[0x1FA78],[0x1F48A],[0x1FA79],[0x1FA7A],[0x1F6AA],[0x1F6D7],[0x1FA9E],[0x1FA9F],[0x1F6CF],[0x1F6CB],[0x1FA91],[0x1F6BD],[0x1FAA0],[0x1F6BF],[0x1F6C1],[0x1FAA4],[0x1FA92],[0x1F9F4],[0x1F9F7],[0x1F9F9],[0x1F9FA],[0x1F9FB],[0x1FAA3],[0x1F9FC],[0x1FAA5],[0x1F9FD],[0x1F9EF],[0x1F6D2],[0x1F6AC],[0x26B0],[0x1FAA6],[0x26B1],[0x1F5FF],[0x1FAA7],[0x1F3E7],[0x1F6AE],[0x1F6B0],[0x267F],[0x1F6B9],[0x1F6BA],[0x1F6BB],[0x1F6BC],[0x1F6BE],[0x1F6C2],[0x1F6C3],[0x1F6C4],[0x1F6C5],[0x26A0],[0x1F6B8],[0x26D4],[0x1F6AB],[0x1F6B3],[0x1F6AD],[0x1F6AF],[0x1F6B1],[0x1F6B7],[0x1F4F5],[0x1F51E],[0x2622],[0x2623],[0x2B06],[0x2197],[0x27A1],[0x2198],[0x2B07],[0x2199],[0x2B05],[0x2196],[0x2195],[0x2194],[0x21A9],[0x21AA],[0x2934],[0x2935],[0x1F503],[0x1F504],[0x1F519],[0x1F51A],[0x1F51B],[0x1F51C],[0x1F51D],[0x1F6D0],[0x269B],[0x1F549],[0x2721],[0x2638],[0x262F],[0x271D],[0x2626],[0x262A],[0x262E],[0x1F54E],[0x1F52F],[0x2648],[0x2649],[0x264A],[0x264B],[0x264C],[0x264D],[0x264E],[0x264F],[0x2650],[0x2651],[0x2652],[0x2653],[0x26CE],[0x1F500],[0x1F501],[0x1F502],[0x25B6],[0x23E9],[0x23ED],[0x23EF],[0x25C0],[0x23EA],[0x23EE],[0x1F53C],[0x23EB],[0x1F53D],[0x23EC],[0x23F8],[0x23F9],[0x23FA],[0x23CF],[0x1F3A6],[0x1F505],[0x1F506],[0x1F4F6],[0x1F4F3],[0x1F4F4],[0x2640],[0x2642],[0x26A7],[0x2716],[0x2795],[0x2796],[0x2797],[0x267E],[0x203C],[0x2049],[0x2753],[0x2754],[0x2755],[0x2757],[0x3030],[0x1F4B1],[0x1F4B2],[0x2695],[0x267B],[0x269C],[0x1F531],[0x1F4DB],[0x1F530],[0x2B55],[0x2705],[0x2611],[0x2714],[0x274C],[0x274E],[0x27B0],[0x27BF],[0x303D],[0x2733],[0x2734],[0x2747],[0xA9],[0xAE],[0x2122],[0x23,0xFE0F,0x20E3],[0x2A,0xFE0F,0x20E3],[0x30,0xFE0F,0x20E3],[0x31,0xFE0F,0x20E3],[0x32,0xFE0F,0x20E3],[0x33,0xFE0F,0x20E3],[0x34,0xFE0F,0x20E3],[0x35,0xFE0F,0x20E3],[0x36,0xFE0F,0x20E3],[0x37,0xFE0F,0x20E3],[0x38,0xFE0F,0x20E3],[0x39,0xFE0F,0x20E3],[0x1F51F],[0x1F520],[0x1F521],[0x1F522],[0x1F523],[0x1F524],[0x1F170],[0x1F18E],[0x1F171],[0x1F191],[0x1F192],[0x1F193],[0x2139],[0x1F194],[0x24C2],[0x1F195],[0x1F196],[0x1F17E],[0x1F197],[0x1F17F],[0x1F198],[0x1F199],[0x1F19A],[0x1F201],[0x1F202],[0x1F237],[0x1F236],[0x1F22F],[0x1F250],[0x1F239],[0x1F21A],[0x1F232],[0x1F251],[0x1F238],[0x1F234],[0x1F233],[0x3297],[0x3299],[0x1F23A],[0x1F235],[0x1F534],[0x1F7E0],[0x1F7E1],[0x1F7E2],[0x1F535],[0x1F7E3],[0x1F7E4],[0x26AB],[0x26AA],[0x1F7E5],[0x1F7E7],[0x1F7E8],[0x1F7E9],[0x1F7E6],[0x1F7EA],[0x1F7EB],[0x2B1B],[0x2B1C],[0x25FC],[0x25FB],[0x25FE],[0x25FD],[0x25AA],[0x25AB],[0x1F536],[0x1F537],[0x1F538],[0x1F539],[0x1F53A],[0x1F53B],[0x1F4A0],[0x1F518],[0x1F533],[0x1F532],[0x1F3C1],[0x1F6A9],[0x1F38C],[0x1F3F4],[0x1F3F3],[0x1F3F3,0xFE0F,0x200D,0x1F308],[0x1F3F3,0xFE0F,0x200D,0x26A7,0xFE0F],[0x1F3F4,0x200D,0x2620,0xFE0F],[0x1F1E6,0x1F1E8],[0x1F1E6,0x1F1E9],[0x1F1E6,0x1F1EA],[0x1F1E6,0x1F1EB],[0x1F1E6,0x1F1EC],[0x1F1E6,0x1F1EE],[0x1F1E6,0x1F1F1],[0x1F1E6,0x1F1F2],[0x1F1E6,0x1F1F4],[0x1F1E6,0x1F1F6],[0x1F1E6,0x1F1F7],[0x1F1E6,0x1F1F8],[0x1F1E6,0x1F1F9],[0x1F1E6,0x1F1FA],[0x1F1E6,0x1F1FC],[0x1F1E6,0x1F1FD],[0x1F1E6,0x1F1FF],[0x1F1E7,0x1F1E6],[0x1F1E7,0x1F1E7],[0x1F1E7,0x1F1E9],[0x1F1E7,0x1F1EA],[0x1F1E7,0x1F1EB],[0x1F1E7,0x1F1EC],[0x1F1E7,0x1F1ED],[0x1F1E7,0x1F1EE],[0x1F1E7,0x1F1EF],[0x1F1E7,0x1F1F1],[0x1F1E7,0x1F1F2],[0x1F1E7,0x1F1F3],[0x1F1E7,0x1F1F4],[0x1F1E7,0x1F1F6],[0x1F1E7,0x1F1F7],[0x1F1E7,0x1F1F8],[0x1F1E7,0x1F1F9],[0x1F1E7,0x1F1FB],[0x1F1E7,0x1F1FC],[0x1F1E7,0x1F1FE],[0x1F1E7,0x1F1FF],[0x1F1E8,0x1F1E6],[0x1F1E8,0x1F1E8],[0x1F1E8,0x1F1E9],[0x1F1E8,0x1F1EB],[0x1F1E8,0x1F1EC],[0x1F1E8,0x1F1ED],[0x1F1E8,0x1F1EE],[0x1F1E8,0x1F1F0],[0x1F1E8,0x1F1F1],[0x1F1E8,0x1F1F2],[0x1F1E8,0x1F1F3],[0x1F1E8,0x1F1F4],[0x1F1E8,0x1F1F5],[0x1F1E8,0x1F1F7],[0x1F1E8,0x1F1FA],[0x1F1E8,0x1F1FB],[0x1F1E8,0x1F1FC],[0x1F1E8,0x1F1FD],[0x1F1E8,0x1F1FE],[0x1F1E8,0x1F1FF],[0x1F1E9,0x1F1EA],[0x1F1E9,0x1F1EC],[0x1F1E9,0x1F1EF],[0x1F1E9,0x1F1F0],[0x1F1E9,0x1F1F2],[0x1F1E9,0x1F1F4],[0x1F1E9,0x1F1FF],[0x1F1EA,0x1F1E6],[0x1F1EA,0x1F1E8],[0x1F1EA,0x1F1EA],[0x1F1EA,0x1F1EC],[0x1F1EA,0x1F1ED],[0x1F1EA,0x1F1F7],[0x1F1EA,0x1F1F8],[0x1F1EA,0x1F1F9],[0x1F1EA,0x1F1FA],[0x1F1EB,0x1F1EE],[0x1F1EB,0x1F1EF],[0x1F1EB,0x1F1F0],[0x1F1EB,0x1F1F2],[0x1F1EB,0x1F1F4],[0x1F1EB,0x1F1F7],[0x1F1EC,0x1F1E6],[0x1F1EC,0x1F1E7],[0x1F1EC,0x1F1E9],[0x1F1EC,0x1F1EA],[0x1F1EC,0x1F1EB],[0x1F1EC,0x1F1EC],[0x1F1EC,0x1F1ED],[0x1F1EC,0x1F1EE],[0x1F1EC,0x1F1F1],[0x1F1EC,0x1F1F2],[0x1F1EC,0x1F1F3],[0x1F1EC,0x1F1F5],[0x1F1EC,0x1F1F6],[0x1F1EC,0x1F1F7],[0x1F1EC,0x1F1F8],[0x1F1EC,0x1F1F9],[0x1F1EC,0x1F1FA],[0x1F1EC,0x1F1FC],[0x1F1EC,0x1F1FE],[0x1F1ED,0x1F1F0],[0x1F1ED,0x1F1F2],[0x1F1ED,0x1F1F3],[0x1F1ED,0x1F1F7],[0x1F1ED,0x1F1F9],[0x1F1ED,0x1F1FA],[0x1F1EE,0x1F1E8],[0x1F1EE,0x1F1E9],[0x1F1EE,0x1F1EA],[0x1F1EE,0x1F1F1],[0x1F1EE,0x1F1F2],[0x1F1EE,0x1F1F3],[0x1F1EE,0x1F1F4],[0x1F1EE,0x1F1F6],[0x1F1EE,0x1F1F7],[0x1F1EE,0x1F1F8],[0x1F1EE,0x1F1F9],[0x1F1EF,0x1F1EA],[0x1F1EF,0x1F1F2],[0x1F1EF,0x1F1F4],[0x1F1EF,0x1F1F5],[0x1F1F0,0x1F1EA],[0x1F1F0,0x1F1EC],[0x1F1F0,0x1F1ED],[0x1F1F0,0x1F1EE],[0x1F1F0,0x1F1F2],[0x1F1F0,0x1F1F3],[0x1F1F0,0x1F1F5],[0x1F1F0,0x1F1F7],[0x1F1F0,0x1F1FC],[0x1F1F0,0x1F1FE],[0x1F1F0,0x1F1FF],[0x1F1F1,0x1F1E6],[0x1F1F1,0x1F1E7],[0x1F1F1,0x1F1E8],[0x1F1F1,0x1F1EE],[0x1F1F1,0x1F1F0],[0x1F1F1,0x1F1F7],[0x1F1F1,0x1F1F8],[0x1F1F1,0x1F1F9],[0x1F1F1,0x1F1FA],[0x1F1F1,0x1F1FB],[0x1F1F1,0x1F1FE],[0x1F1F2,0x1F1E6],[0x1F1F2,0x1F1E8],[0x1F1F2,0x1F1E9],[0x1F1F2,0x1F1EA],[0x1F1F2,0x1F1EB],[0x1F1F2,0x1F1EC],[0x1F1F2,0x1F1ED],[0x1F1F2,0x1F1F0],[0x1F1F2,0x1F1F1],[0x1F1F2,0x1F1F2],[0x1F1F2,0x1F1F3],[0x1F1F2,0x1F1F4],[0x1F1F2,0x1F1F5],[0x1F1F2,0x1F1F6],[0x1F1F2,0x1F1F7],[0x1F1F2,0x1F1F8],[0x1F1F2,0x1F1F9],[0x1F1F2,0x1F1FA],[0x1F1F2,0x1F1FB],[0x1F1F2,0x1F1FC],[0x1F1F2,0x1F1FD],[0x1F1F2,0x1F1FE],[0x1F1F2,0x1F1FF],[0x1F1F3,0x1F1E6],[0x1F1F3,0x1F1E8],[0x1F1F3,0x1F1EA],[0x1F1F3,0x1F1EB],[0x1F1F3,0x1F1EC],[0x1F1F3,0x1F1EE],[0x1F1F3,0x1F1F1],[0x1F1F3,0x1F1F4],[0x1F1F3,0x1F1F5],[0x1F1F3,0x1F1F7],[0x1F1F3,0x1F1FA],[0x1F1F3,0x1F1FF],[0x1F1F4,0x1F1F2],[0x1F1F5,0x1F1E6],[0x1F1F5,0x1F1EA],[0x1F1F5,0x1F1EB],[0x1F1F5,0x1F1EC],[0x1F1F5,0x1F1ED],[0x1F1F5,0x1F1F0],[0x1F1F5,0x1F1F1],[0x1F1F5,0x1F1F2],[0x1F1F5,0x1F1F3],[0x1F1F5,0x1F1F7],[0x1F1F5,0x1F1F8],[0x1F1F5,0x1F1F9],[0x1F1F5,0x1F1FC],[0x1F1F5,0x1F1FE],[0x1F1F6,0x1F1E6],[0x1F1F7,0x1F1EA],[0x1F1F7,0x1F1F4],[0x1F1F7,0x1F1F8],[0x1F1F7,0x1F1FA],[0x1F1F7,0x1F1FC],[0x1F1F8,0x1F1E6],[0x1F1F8,0x1F1E7],[0x1F1F8,0x1F1E8],[0x1F1F8,0x1F1E9],[0x1F1F8,0x1F1EA],[0x1F1F8,0x1F1EC],[0x1F1F8,0x1F1ED],[0x1F1F8,0x1F1EE],[0x1F1F8,0x1F1EF],[0x1F1F8,0x1F1F0],[0x1F1F8,0x1F1F1],[0x1F1F8,0x1F1F2],[0x1F1F8,0x1F1F3],[0x1F1F8,0x1F1F4],[0x1F1F8,0x1F1F7],[0x1F1F8,0x1F1F8],[0x1F1F8,0x1F1F9],[0x1F1F8,0x1F1FB],[0x1F1F8,0x1F1FD],[0x1F1F8,0x1F1FE],[0x1F1F8,0x1F1FF],[0x1F1F9,0x1F1E6],[0x1F1F9,0x1F1E8],[0x1F1F9,0x1F1E9],[0x1F1F9,0x1F1EB],[0x1F1F9,0x1F1EC],[0x1F1F9,0x1F1ED],[0x1F1F9,0x1F1EF],[0x1F1F9,0x1F1F0],[0x1F1F9,0x1F1F1],[0x1F1F9,0x1F1F2],[0x1F1F9,0x1F1F3],[0x1F1F9,0x1F1F4],[0x1F1F9,0x1F1F7],[0x1F1F9,0x1F1F9],[0x1F1F9,0x1F1FB],[0x1F1F9,0x1F1FC],[0x1F1F9,0x1F1FF],[0x1F1FA,0x1F1E6],[0x1F1FA,0x1F1EC],[0x1F1FA,0x1F1F2],[0x1F1FA,0x1F1F3],[0x1F1FA,0x1F1F8],[0x1F1FA,0x1F1FE],[0x1F1FA,0x1F1FF],[0x1F1FB,0x1F1E6],[0x1F1FB,0x1F1E8],[0x1F1FB,0x1F1EA],[0x1F1FB,0x1F1EC],[0x1F1FB,0x1F1EE],[0x1F1FB,0x1F1F3],[0x1F1FB,0x1F1FA],[0x1F1FC,0x1F1EB],[0x1F1FC,0x1F1F8],[0x1F1FD,0x1F1F0],[0x1F1FE,0x1F1EA],[0x1F1FE,0x1F1F9],[0x1F1FF,0x1F1E6],[0x1F1FF,0x1F1F2],[0x1F1FF,0x1F1FC],[0x1F3F4,0xE0067,0xE0062,0xE0065,0xE006E,0xE0067,0xE007F],[0x1F3F4,0xE0067,0xE0062,0xE0073,0xE0063,0xE0074,0xE007F],[0x1F3F4,0xE0067,0xE0062,0xE0077,0xE006C,0xE0073,0xE007F],];// Special objects
var Return = function(name, value){
    var self = this;
    self.name = (name===undefined)?null:name;
    self.value = (value===undefined)?null:value;
    return self;
};

var Restart = function(name, args){
    var self = this;
    self.name = name;
    self.args = (args===undefined)?[]:args;
    return self;
};

var Symbol = function(name, pkg){
    var self = this;
    if(!name) throw "Cannot create symbol with empty name.";
    self.name = name;
    self.pkg = pkg || null;
    self.toString = ()=>{
        return self.name;
    };
    return self;
};

var Keyword = function(name){
    var self = this;
    Symbol.call(self, name, "KEYWORD");
    return self;
};
Keyword.prototype = Object.create(Symbol.prototype);

var CL = function(){
    var self = this;
    var symbols = {};
    var classes = {};

    self.computeClassPrecedenceList = (c)=>{
        var nodes = {};
        var edges = {};
        var sorted = [];
        var map;
        map = (c)=>{
            nodes[c.className] = "unvisited";
            var prev = c;
            for(var s of c.directSuperclasses){
                if(!edges[prev.className])edges[prev.className]=[];
                cl.pushnew(s.className, edges[prev.className]);
                map(s);
                prev = s;
            }
        };
        map(c);
        // Tarjan
        var visit;
        visit = (name)=>{
            if(nodes[name] === "temporary")
                cl.error("DEPENDENCY-CYCLE",{node: name});
            nodes[name] = "temporary";
            for(target of (edges[name]||[])){
                visit(target);
            }
            delete nodes[name];
            if(cl.findClass(name))
                cl.pushnew(cl.findClass(name), sorted);
        };
        for(;;){
            var name = Object.keys(nodes)[0];
            if(name === undefined)
                break;
            visit(name);
        }
        return sorted;
    };

    self.defclass = (name, directSuperclasses, initforms, constructor)=>{
        if(directSuperclasses.length === 0)
            directSuperclasses = ["StandardObject"];
        if(initforms === undefined) initforms = {};
        if(constructor === undefined) constructor=()=>{};
        directSuperclasses = self.mapcar(self.findClass, directSuperclasses);
        if(typeof name == 'string'){
            self.intern(name, "LICHAT-PROTOCOL");
        }
        for(initarg in initforms){
            self.intern(initarg.toUpperCase(), "KEYWORD");
        }

        var c = function(initargs){
            var iself = this;
            StandardObject.call(iself, initargs);
            for(var key in initforms){
                var val = initforms[key];
                iself.set(key, (val instanceof Function)?val(iself):val);
            }
            for(var superclass of directSuperclasses){
                superclass.call(iself, initargs);
            }
            constructor(iself);
            return iself;
        };
        c.prototype = Object.create(directSuperclasses[0].prototype);
        c.prototype.className = name;
        c.className = name;
        c.directSuperclasses = directSuperclasses;
        c.superclasses = self.computeClassPrecedenceList(c);

        classes[name] = c;        
        return name;
    };

    self.makeInstance = (name, ...args)=>{
        return Reflect.construct(self.findClass(name, true), args);
    };

    self.findClass = (name, error)=>{
        if(classes[name])
            return classes[name];
        if(error)
            cl.error("NO-SUCH-CLASS",{name: name});
        return null;
    };

    self.classOf = (instance)=>{
        return self.findClass(instance.className);
    };

    self.setClass = (name, c)=>{
        if(c)
            classes[name] = c;
        else
            delete classes[name];
    };

    self.requiredArg = (name)=>{
        return (e)=>{
            if(e[name] === undefined)
                cl.error("MISSING-INITARG",{object:e, initarg:name, text: "The initarg "+name+" is missing."});
            else
                return e[name];
            return null;
        };
    };

    self.typep = (instance, type)=>{
        if(type === true){
            return true;
        }else if(type === null){
            if(instance === null){
                return true;
            }
        }else if(type === "Boolean"){
            if(instance === true || instance === false){
                return true;
            }
        }else if(instance instanceof StandardObject){
            if(instance.type === type
               || instance.isInstanceOf(type)){
                return true;
            }
        }else if(window[type]){
            if(window[type].prototype.isPrototypeOf(instance)
               || instance.constructor === window[type].prototype.constructor){
                return true;
            }
        }
        return false;
    };
    
    self.intern = (name, pkg)=>{
        var symbol = self.findSymbol(name, pkg);
        if(!symbol){
            if(pkg === "KEYWORD"){
                symbol = new Keyword(name);
            }else{
                symbol = new Symbol(name, pkg || "LICHAT-JS");
            }
            if(symbols[symbol.pkg] === undefined){
                symbols[symbol.pkg] = {};
            }
            symbols[symbol.pkg][symbol.name] = symbol;
        }
        return symbol;
    };

    self.findSymbol = (name, pkg)=>{
        var pkgspace = symbols[pkg || "LICHAT-JS"];
        if(pkgspace === undefined) return null;
        var symbol = pkgspace[name];
        if(symbol === undefined) return null;
        return symbol;
    };

    self.kw = (name)=>{
        return self.intern(name, "KEYWORD");
    };

    self.makeSymbol = (name)=>{
        return new Symbol(name);
    };

    self.prog1 = (value, ...forms)=>{
        var ret = value();
        for(var form of forms){form();}
        return ret;
    };

    self.prog2 = (form, value, ...forms)=>{
        var ret = value();
        form();
        for(var form of forms){form();}
        return ret;
    };

    self.progn = (...forms)=>{
        var ret = null;
        for(var form of forms){ret = form();}
        return ret;
    };

    self.first = (array)=> array[0];
    self.second = (array)=> array[1];
    self.third = (array)=> array[2];
    self.fourth = (array)=> array[3];

    self.gt = (a, b)=> a>b;
    self.lt = (a, b)=> a<b;

    self.unwindProtect = (protect, cleanup)=>{
        try{
            self.prog1(protect, cleanup);
        }catch(e){
            cleanup();
            throw e;
        }
    };

    self.argTypecase = (object, args, ...cases)=>{
        for(var i=0; i<cases.length; i+=2){
            var type = cases[i];
            var func = cases[i+1];
            if(self.typep(object, type)){
                return func.apply(func, args);
            }
        }
        return null;
    };

    self.typecase = (object, ...cases)=>{
        self.push([], cases);
        self.push(object, cases);
        return self.argTypecase.apply(self, cases);
    };

    self.handlerCase = (form, ...cases)=>{
        try{
            return form();
        }catch(e){
            cases.push(true);
            cases.push((e)=>{throw e;});
            self.push([e], cases);
            self.push(e, cases);
            return self.argTypecase.apply(self, cases);
        }
    };

    self.block = (name, ...forms)=>{
        var handleReturn = (r)=>{
            if(r.name === name){
                return r.value;
            }else{
                throw r;
            }
        };
        return self.handlerCase(()=>{self.progn.apply(self,forms);},
                                "Return", handleReturn);
    };

    self.retFrom = (name, value)=>{
        throw new Return(name, value);
    };

    self.ret = (value)=>{
        throw new Return(null, value);
    };

    self.restartCase = (form, ...cases)=>{
        var handleRestart = (r)=>{
            for(var i=0; i<cases.length; i++){
                var name = cases[i];
                var form = cases[i+1];
                if(name === r.name){
                    return form.apply(form, r.args);
                }
            }
            return null;
        };
        self.handlerCase(form, "Restart", handleRestart);
    };

    self.invokeRestart = (name, args)=>{
        throw new Restart.apply(name, args);
    };

    self.universalUnixOffset = 2208988800;

    self.getUniversalTime = ()=>{
        return Math.round(Date.now()/1000)+self.universalUnixOffset;
    };

    self.universalToUnix = (universal)=>{
        return universal-self.universalUnixOffset;
    };

    self.push = (el, arr)=>{
        arr.unshift(el);
        return arr;
    };

    self.pushnew = (el, arr)=>{
        if(arr.indexOf(el) < 0){
            self.push(el, arr);
        }
        return arr;
    };

    self.nconc = (target, arrays)=>{
        for(var array of arrays){
            for(var item of array){
                target.push(item);
            }
        }
        return target;
    };

    self.remove = (el, arr, key)=>{
        key = key || ((a)=>a);
        var newarr = [];
        for(var item of arr){
            if(key(item) !== el)
                newarr.push(item);
        }
        return newarr;
    };

    self.find = (el, arr, key, test)=>{
        test = test || ((a,b)=>{return a===b;});
        key = key || ((a)=>a);
        for(var item of arr){
            if(test(el, key(item)))
                return item;
        }
        return null;
    };

    self.sort = (arr, sort, key)=>{
        key = key || ((a)=>a);
        arr.sort((a, b)=>sort(key(b), key(a)));
        return arr;
    };

    self.mapcar = (func, ...arrays)=>{
        var min = 0;
        for(arr of arrays)min = Math.max(min,arr.length);
        var result = [];
        for(var i=0; i<min; i++){
            var args = [];
            for(var array of arrays)args.push(array[i]);
            result.push(func.apply(func, args));
        }
        return result;
    };

    self.sxhash = (object)=>{
        var str = object.toString();
        var hash = 0;
        for(var i=0; i<str.length; i++){
            hash  = ((hash << 5) - hash + str.charCodeAt(i++)) << 0;
        }
        return hash;
    };

    self.print = (object)=>{
        if(console)
            console.log(object);
        return object;
    };

    self.error = (type, initargs)=>{
        initargs.stack = new Error().stack;
        var condition = new Condition(type, initargs);
        throw condition;
    };

    var formatDispatch = {};
    self.format = (string, ...args)=>{
        var stream = new LichatStream(string);
        var varray = [""];
        loop:
        for(;;){
            var c = stream.readChar(false);
            switch(c){
            case null: break loop;
            case "~":
                var at = false, colon = false;
                readDirectiveChar:
                for(;;){
                    c = stream.readChar(false);
                    switch(c){
                    case null: self.error("FORMAT-ERROR",{text:"Premature end of format string."});
                    case "@": at = true; readDirectiveChar(); break;
                    case ":": colon = true; readDirectiveChar(); break;
                    default:
                        var dispatch = formatDispatch[c.toLowerCase()];
                        if(!dispatch)
                            self.error("FORMAT-ERROR",{text:"Unknown format directive "+c});
                        if(args.length === 0)
                            self.error("FORMAT-ERROR",{text:"No more arguments left."});
                        dispatch(varray, at, colon, args);
                        break readDirectiveChar;
                    }
                }
                break;
            default:
                varray[varray.length-1] += c;
            }
        }
        if(console)
            console.log.apply(console, varray);
        return null;
    };

    self.setFormatDispatcher = (c, handler)=>{
        formatDispatch[c.toLowerCase()] = handler;
        return handler;
    };

    self.setFormatDispatcher("a", (varray, a, c, args)=>{
        varray[varray.length-1] += args.shift();
    });

    self.setFormatDispatcher("s", (varray, a, c, args)=>{
        varray.push(args.shift());
        varray.push("");
    });

    self.T = self.intern("T", "LICHAT-PROTOCOL");
    self.NIL = self.intern("NIL", "LICHAT-PROTOCOL");

    self.null = (arg)=>{
        return !arg || (arg === self.NIL);
    };

    self.streq = (a, b)=>{
        return a.toLowerCase() == b.toLowerCase();
    };

    return self;
};

var cl = new CL();

// Inject Standard Object
var StandardObject = function(initargs){
    var self = this;
    
    self.type = self.className;

    for(var key in initargs){
        self.set(key, initargs[key]);
    }

    return self;
};
cl.setClass("StandardObject", StandardObject);
StandardObject.className = "StandardObject";
StandardObject.directSuperclasses = [];
StandardObject.superclasses = [];

StandardObject.prototype.isInstanceOf = function(superclass){
    var self = this;
    if(superclass === true)
        return true;
    if((typeof superclass) === "string")
        superclass = cl.findClass(superclass);
    return cl.find(superclass, cl.classOf(self).superclasses);
};

StandardObject.prototype.set = function(key, val){
    var self = this;
    var varname;
    if(self.fields === undefined) self.fields = [];
    if(key instanceof Symbol){
        varname = key.name.toLowerCase();
    }else{
        varname = key.toString();
    }
    self[varname] = val;
    cl.pushnew(varname, self.fields);
    return val;
};

// Special type argument to allow cheap pseudo-subclassing.
var Condition = function(type, initargs){
    var self = this;
    StandardObject.call(self, initargs);
    self.type = type;
    return self;
};
Condition.prototype = Object.create(StandardObject.prototype);
Condition.prototype.report = function(){
    var self = this;
    return "Condition of type ["+self.type+"]"+(self.text?": "+self.text:"");
};
var LichatStream = function(string){
    var self = this;
    self.string = string || "";
    var i = 0;

    self.readChar = (errorp)=>{
        if(errorp === undefined)errorp = true;
        if(i < self.string.length){
            var character = self.string[i];
            i++;
            return character;
        }else if(errorp){
            cl.error("END-OF-STREAM");
        }
        return null;
    };

    self.unreadChar = ()=>{
        if(0 < i){
            i--;
        }else{
            cl.error("BEGINNING-OF-STREAM");
        }
    };

    self.peekChar = (errorp)=>{
        if(errorp === undefined)errorp = true;
        if(i < self.string.length){
            return self.string[i];
        }else if(errorp){
            cl.error("END-OF-STREAM");
        }
        return null;
    };

    self.writeChar = (character)=>{
        self.string += character;
        return character;
    };

    self.writeString = (string)=>{
        self.string += string;
        return string;
    };

    self.toString = ()=>{
        return self.string;
    };
    
    return self;
};
var LichatVersion = "2.0";
var IDCounter = Math.floor(Math.random()*(+new Date()));
var nextID = ()=>{
    var ID = IDCounter;
    IDCounter++;
    return ID;
};

cl.defclass("WIRE-OBJECT", []);
cl.defclass("UPDATE", ["WIRE-OBJECT"], {
    clock: cl.getUniversalTime,
    id: nextID,
    from: null
});
cl.defclass("PING", ["UPDATE"]);
cl.defclass("PONG", ["UPDATE"]);
cl.defclass("CONNECT", ["UPDATE"], {
    password: null,
    version: LichatVersion,
    extensions: []
});
cl.defclass("DISCONNECT", ["UPDATE"]);
cl.defclass("REGISTER", ["UPDATE"], {
    password: cl.requiredArg("password")
});
cl.defclass("CHANNEL-UPDATE", ["UPDATE"], {
    channel: cl.requiredArg("channel"),
    bridge: null
});
cl.defclass("TARGET-UPDATE", ["UPDATE"], {
    target: cl.requiredArg("target")
});
cl.defclass("TEXT-UPDATE", ["UPDATE"], {
    text: cl.requiredArg("text")
});
cl.defclass("JOIN", ["CHANNEL-UPDATE"]);
cl.defclass("LEAVE", ["CHANNEL-UPDATE"]);
cl.defclass("CREATE", ["CHANNEL-UPDATE"], {
    channel: null
});
cl.defclass("KICK", ["CHANNEL-UPDATE", "TARGET-UPDATE"]);
cl.defclass("PULL", ["CHANNEL-UPDATE", "TARGET-UPDATE"]);
cl.defclass("PERMISSIONS", ["CHANNEL-UPDATE"], {
    permissions: []
});
cl.defclass("GRANT", ["CHANNEL-UPDATE", "TARGET-UPDATE"], {
    update: cl.requiredArg("update")
});
cl.defclass("DENY", ["CHANNEL-UPDATE", "TARGET-UPDATE"], {
    update: cl.requiredArg("update")
});
cl.defclass("CAPABILITIES", ["CHANNEL-UPDATE"], {
    permitted: []
});
cl.defclass("MESSAGE", ["CHANNEL-UPDATE", "TEXT-UPDATE"], {
    bridge: null,
    link: null
});
cl.defclass("EDIT", ["CHANNEL-UPDATE", "TEXT-UPDATE"]);
cl.defclass("USERS", ["CHANNEL-UPDATE"], {
    users: []
});
cl.defclass("CHANNELS", ["UPDATE"], {
    channels: []
});
cl.defclass("USER-INFO", ["TARGET-UPDATE"], {
    registered: false,
    connections: 1,
    info: []
});
cl.defclass("SERVER-INFO", ["TARGET-UPDATE"], {
    attributes: [],
    connections: []
});
cl.defclass("BACKFILL", ["CHANNEL-UPDATE"]);
cl.defclass("DATA", ["CHANNEL-UPDATE"], {
    "content-type": cl.requiredArg("content-type"),
    filename: null,
    payload: cl.requiredArg("payload")
});
cl.defclass("EMOTES", ["UPDATE"], {
    names: []
});
cl.defclass("EMOTE", ["UPDATE"], {
    "content-type": cl.requiredArg("content-type"),
    name: cl.requiredArg("name"),
    payload: cl.requiredArg("payload")
});
cl.defclass("CHANNEL-INFO", ["CHANNEL-UPDATE"], {
    keys: true
});
cl.defclass("SET-CHANNEL-INFO", ["CHANNEL-UPDATE", "TEXT-UPDATE"], {
    key: cl.requiredArg("key")
});
cl.defclass("SET-USER-INFO", ["TEXT-UPDATE"], {
    key: cl.requiredArg("key")
});
cl.defclass("PAUSE", ["CHANNEL-UPDATE"], {
    by: cl.requiredArg("by")
});
cl.defclass("QUIET", ["CHANNEL-UPDATE","TARGET-UPDATE"]);
cl.defclass("UNQUIET", ["CHANNEL-UPDATE","TARGET-UPDATE"]);
cl.defclass("KILL", ["TARGET-UPDATE"]);
cl.defclass("DESTROY", ["CHANNEL-UPDATE"]);
cl.defclass("BAN", ["TARGET-UPDATE"]);
cl.defclass("UNBAN", ["TARGET-UPDATE"]);
cl.defclass("IP-BAN", [], {
    ip: cl.requiredArg("ip"),
    mask: cl.requiredArg("mask")
});
cl.defclass("IP-UNBAN", [], {
    ip: cl.requiredArg("ip"),
    mask: cl.requiredArg("mask")
});
cl.defclass("BLOCK", ["TARGET-UPDATE"]);
cl.defclass("UNBLOCK", ["TARGET-UPDATE"]);
cl.defclass("REACT", ["CHANNEL-UPDATE"], {
    target: cl.requiredArg("target"),
    "update-id": cl.requiredArg("update-id"),
    emote: cl.requiredArg("emote")
});

cl.defclass("FAILURE", ["TEXT-UPDATE"]);
cl.defclass("MALFORMED-UPDATE", ["FAILURE"]);
cl.defclass("UPDATE-TOO-LONG", ["FAILURE"]);
cl.defclass("CONNECTION-UNSTABLE", ["FAILURE"]);
cl.defclass("TOO-MANY-CONNECTIONS", ["FAILURE"]);
cl.defclass("UPDATE-FAILURE", ["FAILURE"], {
    "update-id": cl.requiredArg("update-id")
});
cl.defclass("INVALID-UPDATE", ["UPDATE-FAILURE"]);
cl.defclass("USERNAME-MISMATCH", ["UPDATE-FAILURE"]);
cl.defclass("INCOMPATIBLE-VERSION", ["UPDATE-FAILURE"], {
    "compatible-versions": cl.requiredArg("compatible-versions")
});
cl.defclass("INVALID-PASSWORD", ["UPDATE-FAILURE"]);
cl.defclass("NO-SUCH-PROFILE", ["UPDATE-FAILURE"]);
cl.defclass("USERNAME-TAKEN", ["UPDATE-FAILURE"]);
cl.defclass("NO-SUCH-CHANNEL", ["UPDATE-FAILURE"]);
cl.defclass("ALREADY-IN-CHANNEL", ["UPDATE-FAILURE"]);
cl.defclass("NOT-IN-CHANNEL", ["UPDATE-FAILURE"]);
cl.defclass("CHANNELNAME-TAKEN", ["UPDATE-FAILURE"]);
cl.defclass("BAD-NAME", ["UPDATE-FAILURE"]);
cl.defclass("INSUFFICIENT-PERMISSIONS", ["UPDATE-FAILURE"]);
cl.defclass("NO-SUCH-USER", ["UPDATE-FAILURE"]);
cl.defclass("TOO-MANY-UPDATES", ["UPDATE-FAILURE"]);
cl.defclass("BAD-CONTENT-TYPE", ["UPDATE-FAILURE"], {
    "allowed-content-types": []
});
cl.defclass("NO-SUCH-CHANNEL-INFO", ["UPDATE-FAILURE"], {
    key: cl.requiredArg("key")
});
cl.defclass("MALFORMED-CHANNEL-INFO", ["UPDATE-FAILURE"]);
cl.defclass("NO-SUCH-USER-INFO", ["UPDATE-FAILURE"], {
    key: cl.requiredArg("key")
});
cl.defclass("MALFORMED-USER-INFO", ["UPDATE-FAILURE"]);
cl.defclass("CLOCK-SKEWED", ["UPDATE-FAILURE"]);
var LichatPrinter = function(){
    var self = this;

    self.printSexprList = (list, stream)=>{
        stream.writeChar("(");
        cl.unwindProtect(()=>{
            for(var i=0; i<list.length; i++){
                self.printSexpr(list[i], stream);
                if(i+1 < list.length){
                    stream.writeChar(" ");
                }
            }
        },()=>{
            stream.writeChar(")");
        });
    };

    self.printSexprString = (string, stream)=>{
        stream.writeChar("\"");
        cl.unwindProtect(()=>{
            for(var character of string){
                if(character === "\"" | character === "\\"){
                    stream.writeChar("\\");
                }
                stream.writeChar(character);
            }
        },()=>{
            stream.writeChar("\"");
        });
    };

    self.printSexprNumber = (number, stream)=>{
        if(Math.abs(number) < 1.0){
            var e = parseInt(number.toString().split('e-')[1]);
            if(e){
                number *= Math.pow(10,e-1);
                number = '0.' + (new Array(e)).join('0') + number.toString().substring(2);
            }
        }else{
            var e = parseInt(number.toString().split('+')[1]);
            if(e > 20){
                e -= 20;
                number /= Math.pow(10,e);
                number += (new Array(e+1)).join('0');
            }
        }
        stream.writeString(number);
    };
    
    self.printSexprToken = (token, stream)=>{
        for(var character of token){
            if("\\\"():0123456789. #".indexOf(character) >= 0){
                stream.writeChar("\\");
            }
            stream.writeChar(character);
        }
    };

    self.printSexprSymbol = (symbol, stream)=>{
        switch(symbol.pkg){
        case null:
            stream.writeChar("#");
            stream.writeChar(":");
            break;
        case "KEYWORD":
            stream.writeChar(":");
            break;
        case "LICHAT-PROTOCOL":
            break;
        default:
            self.printSexprToken(symbol.pkg, stream);
            stream.writeChar(":");
        }
        self.printSexprToken(symbol.name, stream);
    };

    self.printSexpr = (sexpr, stream)=>{
        cl.typecase(sexpr,
                    null,      ()=> self.printSexprToken("NIL", stream),
                    "String",  ()=> self.printSexprString(sexpr, stream),
                    "Array",   ()=> self.printSexprList(sexpr, stream),
                    "Number",  ()=> self.printSexprNumber(sexpr, stream),
                    "Symbol",  ()=> self.printSexprSymbol(sexpr, stream),
                    "Boolean", ()=> self.printSexprToken((sexpr)?"T":"NIL", stream),
                    true, ()=> cl.error("UNPRINTABLE-OBJECT",{object: sexpr}));
    };

    self.toWire = (wireable, stream)=>{
        if(cl.typep(wireable, "WIRE-OBJECT")){
            var list = [cl.findSymbol(wireable.type, "LICHAT-PROTOCOL")];
            for(var key of wireable.fields){
                list.push(cl.findSymbol(key.toUpperCase(), "KEYWORD"));
                list.push(wireable[key]);
            }
            self.printSexpr(list, stream);
        }else{
            self.printSexpr(wireable, stream);
        }
    };

    return self;
};

LichatPrinter.toString = (wireable)=>{
    var stream = new LichatStream();
    new LichatPrinter().toWire(wireable, stream);
    return stream.string;
};
var LichatReader = function(){
    var self = this;

    self.whitespace = "\u0009\u000A\u000B\u000C\u000D\u0020\u0085\u00A0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2008\u2009\u200A\u2028\u2029\u202F\u205F\u3000\u180E\u200B\u200C\u200D\u2060\uFEFF";
    self.invalidSymbol = cl.makeSymbol("INVALID-SYMBOL");

    self.isWhitespace = (character)=>{
        return self.whitespace.indexOf(character) >= 0;
    };

    self.skipWhitespace = (stream)=>{
        while(self.isWhitespace(stream.readChar()));
        stream.unreadChar();
        return stream;
    };

    self.isProtocolSymbol = (name)=>{
        return self.protocolSymbols.indexOf(name) >= 0;
    };

    self.safeFindSymbol = (name, pkg)=>{
        if(pkg === null){
            return cl.makeSymbol(name);
        }
        return cl.intern(name, pkg);
    };

    self.readSexprList = (stream)=>{
        var array = [];
        self.skipWhitespace(stream);
        while(stream.peekChar() !== ")"){
            array.push(self.readSexpr(stream));
            self.skipWhitespace(stream);
        }
        stream.readChar();
        return array;
    };

    self.readSexprString = (stream)=>{
        var out = new LichatStream();
        loop:
        for(;;){
            var character = stream.readChar();
            switch(character){
            case "\\": out.writeChar(stream.readChar()); break;
            case "\"": break loop;
            default: out.writeChar(character);
            }
        }
        return out.string;
    };

    self.readSexprKeyword = (stream)=>{
        return cl.intern(self.readSexprToken(stream), "KEYWORD");
    };

    self.readSexprNumber = (stream)=>{
        var out = new LichatStream();
        var point = false;
        loop:
        for(var i=0;; i++){
            var character = stream.readChar(false);
            switch(character){
            case null: break loop;
            case ".":
                if(point){
                    stream.unreadChar();
                    break loop;
                }else{
                    point = i;
                }
                break;
            case "0": case "1": case "2": case "3": case "4":
            case "5": case "6": case "7": case "8": case "9":
                out.writeChar(character);
                break;
            default:
                stream.unreadChar();
                break loop;
            }
        }
        var numberString = out.string;
        var number = (numberString === "")? 0 : parseInt(numberString);
        if(point){
            var decimal = numberString.length - point;
            return number/Math.pow(10,decimal);
        }else{
            return number;
        }
    };

    self.readSexprToken = (stream)=>{
        stream.peekChar();
        var out = new LichatStream();
        loop:
        for(;;){
            var character = stream.readChar(false);
            switch(character){
            case null: break loop;
            case "\\": out.writeChar(stream.readChar()); break;
            case "(": case ")": case ".": case " ": case "\"": case ":":
            case "0": case "1": case "2": case "3": case "4":
            case "5": case "6": case "7": case "8": case "9":
                stream.unreadChar(); break loop;
            default:
                out.writeChar(character.toUpperCase());
            }
        }
        return out.string;
    };

    self.readSexprSymbol = (stream)=>{
        var token = self.readSexprToken(stream);
        if(stream.peekChar(false) === ":"){
            stream.readChar();
            if(token === "#"){
                return self.safeFindSymbol(self.readSexprToken(stream), null);
            }else{
                return self.safeFindSymbol(self.readSexprToken(stream), token);
            }
        }else{
            return self.safeFindSymbol(token, "LICHAT-PROTOCOL");
        }
    };

    self.readSexpr = (stream)=>{
        self.skipWhitespace(stream);
        // FIXME: Catch symbol errors
        switch(stream.readChar()){
        case "(": return self.readSexprList(stream);
        case ")": cl.error("INCOMPLETE-TOKEN");
        case "\"": return self.readSexprString(stream);
        case "0": case "1": case "2": case "3": case "4":
        case "5": case "6": case "7": case "8": case "9": case ".":
            stream.unreadChar();
            return self.readSexprNumber(stream);
        case ":": return self.readSexprKeyword(stream);
        default:
            stream.unreadChar();
            return self.readSexprSymbol(stream);
        }
    };

    self.fromWire = (stream)=>{
        var sexpr = self.readSexpr(stream);
        if(sexpr instanceof Array){
            var type = sexpr.shift();
            if(!(type instanceof Symbol))
                cl.error("MALFORMED-WIRE-OBJECT",{text: "First item in list is not a symbol.", sexpr: sexpr});
            
            var initargs = {};
            for(var i=0; i<sexpr.length; i+=2){
                var key = sexpr[i];
                var val = sexpr[i+1];
                if(! key instanceof Symbol || key.pkg !== "KEYWORD"){
                    cl.error("MALFORMED-WIRE-OBJECT",{text: "Key is not of type Keyword.", key: key});
                }
                initargs[key.name.toLowerCase()] = val;
            }
            if(initargs.id === undefined)
                cl.error("MISSING-ID", {sexpr: sexpr});
            if(initargs.clock === undefined)
                cl.error("MISSING-CLOCK", {sexpr: sexpr});
            return cl.makeInstance(type, initargs);
        }else{
            return sexpr;
        }
    };

    return self;
};

LichatReader.fromString = (string)=>{
    return new LichatReader().fromWire(new LichatStream(string));
};
var LichatDefaultPort = 1113;
var LichatDefaultSSLPort = 1114;
var EmptyIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";

class LichatReaction{
    constructor(update, client){
        if(allEmojis.contains(update.emote))
            this.text = update.emote;
        else{
            let emote = client.getChannel(update.channel).getemote(update.emote);
            if(!emote) throw "Invalid emote.";
            this.image = emote;
        }
        this.users = [update.from];
    }

    get count(){
        return this.users.length;
    }
}

class LichatMessage{
    constructor(update, client){
        this._client = client;
        this.id = update.id;
        this.author = client.getUser(update.from);
        this.channel = (update.channel)? client.getChannel(update.channel) : client.primaryChannel;
        this.reactions = {};
        this.text = update.text || "";
        if(cl.typep(update, "MESSAGE"))
            this.contentType = update.link;
        else this.contentType = this._data["content-type"] || "text/plain";
    }

    get time(){
        let local = cl.universalToUnix(this._data.clock);
        let date = new Date(local*1000);
        let pad = (x)=>(x<10?"0":"")+x;
        return pad(date.getHours())+":"+pad(date.getMinutes());
    }

    addReaction(update){
        let reaction = this.reactions[update.emote];
        if(!reaction){
            reaction = new LichatReaction(update, this._client);
            this.reactions[update.emote] = reaction;
        }else if(reaction.users.contains(update.from)){
            reaction.users = reaction.users.filter(item => item == update.from);
        }else{
            rection.users.push(update.from);
        }
        return reaction;
    }
}

class LichatUser{
    constructor(name, client){
        this._name = name;
        this._client = client;
        this.info = {};
    }

    get name(){
        return this._name;
    }

    get icon(){
        let icon = this.info[":ICON"];
        if(!icon) return EmptyIcon;
        let data = icon.split(" ");
        return "data:"+data[0]+";base64,"+data[1];
    }

    get isPresent(){
        return this.isInChannel(this._client.servername);
    }

    isInChannel(channel){
        if(typeof(channel) === "string") channel = this._client.getChannel(channel);
        return channel.hasUser(this);
    }
}

class LichatChannel{
    constructor(name, client){
        this._name = name;
        this._client = client;
        this.wasJoined = false;
        this.users = {};
        this.emotes = {};
        this.info = {};
        this.messages = [];
        this.info[":NEWS"] = "";
        this.info[":TOPIC"] = "";
        this.info[":RULES"] = "";
        this.info[":CONTACT"] = "";
    }

    get name(){
        return this._name;
    }

    get client(){
        return this._client;
    }

    get isPresent(){
        return this.users[this._client.username()] !== undefined;
    }

    get isPrimary(){
        return this._name == this._client.servername;
    }

    get icon(){
        let icon = this.info[":ICON"];
        if(!icon) return EmptyIcon;
        let data = icon.split(" ");
        return "data:"+data[0]+";base64,"+data[1];
    }

    get topic(){
        return this.info["TOPIC"];
    }

    getEmote(name){
        return this.emotes[name.toLowerCase().replace(/^:|:$/g,"")];
    }

    getEmoteList(){
        return Object.keys(this.emotes);
    }

    joinUser(user){
        if(typeof(user) === "string") user = this._client.getUser(user);
        if(user.name === this._client.username) this.wasJoined = true;
        this.users[user.name.toLowerCase()] = user;
        return user;
    }

    leaveUser(user){
        if(typeof(user) === "string") user = this._client.getUser(user);
        if(user.name === this._client.username) this.wasJoined = false;
        delete this.users[user.name.toLowerCase()];
        return user;
    }

    hasUser(user){
        if(user instanceof LichatUser) user = thing.name;
        return this.users[user.toLowerCase()] !== undefined;
    }

    clearUsers(){
        this.users = {};
    }

    s(type, args, noPromise){
        args = args || {};
        args["channel"] = this.name;
        return this._client.s(type, args, noPromise);
    }
};

class LichatClient{
    constructor(options){
        options = options || {};
        this.name = options.name || "Lichat";
        this.username = options.username || null;
        this.password = options.password || null;
        this.hostname = options.hostname || "localhost";
        this.port = options.port || options.ssl? LichatDefaultSSLPort: LichatDefaultPort;
        this.ssl = options.ssl;
        this.disconnectHandler = ()=>{};
        this.servername = null;
        this.pingDelay = 15000;
        this.channels = {};
        this.users = {};

        this.supportedExtensions = ["shirakumo-data", "shirakumo-backfill", "shirakumo-emotes",
                                    "shirakumo-channel-info", "shirakumo-quiet", "shirakumo-pause",
                                    "shirakumo-server-management", "shirakumo-ip", "shirakumo-user-info",
                                    "shirakumo-icon", "shirakumo-bridge", "shirakumo-block",
                                    "shirakumo-reactions", "shirakumo-link"];
        this.availableExtensions = [];
        this._socket = null;
        this._handlers = {};
        this._internalHandlers = {};
        this._idCallbacks = {};
        this._reader = new LichatReader();
        this._printer = new LichatPrinter();
        this._pingTimer = null;
        this._reconnectAttempts = 0;

        this.addInternalHandler("CONNECT", (ev)=>{
            this.availableExtensions = ev.extensions;
        });

        this.addInternalHandler("PING", (ev)=>{
            this.s("PONG", {}, true);
        });

        this.addInternalHandler("PONG", (ev)=>{
        });

        this.addInternalHandler("JOIN", (ev)=>{
            let channel = this.getChannel(ev.channel);
            channel.joinUser(ev.from);

            if(!this.servername){
                this.servername = ev.channel;

                for(let name in this.channels){
                    let channel = this.channels[name];
                    if(channel.wasJoined && channel.name != this.servername)
                        channel.s("JOIN", {}, true);
                }
            }
            if(ev.from === this.username){
                if(this.isAvailable("shirakumo-backfill") && !channel.isPrimary)
                    this.s("BACKFILL", {channel: ev.channel}, true);
                if(this.isAvailable("shirakumo-channel-info"))
                    this.s("CHANNEL-INFO", {channel: ev.channel}, true);
                if(this.isAvailable("shirakumo-emotes"))
                    this.s("EMOTES", {channel: ev.channel, emotes: channel.getEmoteList()}, true);
            }
        });

        this.addInternalHandler("LEAVE", (ev)=>{
            let channel = this.getChannel(ev.channel);
            channel.leaveUser(ev.from);
        });

        this.addInternalHandler("EMOTE", (ev)=>{
            this.addEmote(ev);
        });

        this.addInternalHandler("SET-CHANNEL-INFO", (ev)=>{
            this.channels[ev.channel.toLowerCase()].info[LichatPrinter.toString(ev.key)] = ev.text;
        });
    }

    reconnect(){
        try{
            this.openConnection();
        }catch(e){
            this.scheduleReconnect();
        }
    }

    scheduleReconnect(){
        this._reconnectAttempts++;
        let secs = Math.pow(2, this._reconnectAttempts);
        setTimeout(()=>this.reconnect(), secs*1000);
    }

    openConnection(){
        return new Promise((ok, fail) => {
            this._socket = new WebSocket((this.ssl?"wss://":"ws://")+this.hostname+":"+this.port, "lichat");
            this._socket.onopen = ()=>{
                this.s("CONNECT", {
                    password: this.password || null,
                    version: LichatVersion,
                    extensions: this.supportedExtensions
                }, true);
            };
            this._socket.onmessage = (e)=>{
                let update = this._reader.fromWire(new LichatStream(event.data));
                try{
                    if(!(cl.typep(update, "WIRE-OBJECT")))
                        fail({text: "non-Update message", update: update});
                    else if(update.type !== "CONNECT")
                        fail({text: update.text, update: update});
                    else{
                    }
                }catch(e){
                    this.closeConnection();
                }
                if(!this.username)
                    this.username = update.from;
                if(0 < this._reconnectAttempts)
                    this._reconnectAttempts = 0;
                
                this._socket.onmessage = ev => this.handleMessage(ev);
                this._socket.onclose = ev => this.handleClose(ev);
                this.process(update);
                ok(this);
            };
            this._socket.onclose = (e)=>{
                fail(this, e);
            };
        });
    }

    closeConnection(){
        for(let channel in this.channels)
            this.channels[channel].clearUsers();
        if(this._socket && socket.readyState < 2){
            this._socket.onclose = ()=>{};
            this._socket.close();
        }
        this._socket = null;
        return this;
    }

    send(wireable){
        if(!this._socket || this._socket.readyState != 1)
            cl.error("NOT-CONNECTED",{text: "The client is not connected."});
        if(!cl.typep(wireable, "PING") && !cl.typep(wireable, "PONG"))
            cl.format("[Lichat] Send:~s", wireable);
        let stream = new LichatStream();
        this._printer.toWire(wireable, stream);
        this._socket.send(stream.string+'\u0000');
        return wireable;
    }

    s(type, args, noPromise){
        args = args || {};
        if(!args.from) args.from = this.username;
        let update = cl.makeInstance(type, args);
        if(noPromise) return this.send(update);
        return new Promise((ok, fail)=>{
            this.addCallback(update.id, (u) => {
                if(cl.typep(u, "FAILURE")) fail(u);
                else                       ok(u);
            }, fail);
            this.send(update);
        });
    }

    startDelayPing(){
        if(this._pingTimer) clearTimeout(this._pingTimer);
        this._pingTimer = setTimeout(()=>{
            if(this._socket.readyState == 1){
                this.s("PING", {}, true);
                this.startDelayPing();
            }
        }, this.pingDelay);
        return this._pingTimer;
    }

    handleMessage(event){
        try{
            let update = this._reader.fromWire(new LichatStream(event.data));
            this.startDelayPing();
            this.process(update);
        }catch(e){
            cl.format("Error during message handling: ~s", e);
        }
        return this;
    }

    handleClose(event){
        if(e.code !== 1000){
            this.disconnectHandler(e);
            this.scheduleReconnect();
        }else{
            this.closeConnection();
        }
    }

    processCallbacks(id, update){
        let callbacks = this._idCallbacks[id];
        if(callbacks){
            for(callback of callbacks){
                try{
                    callback.call(this, update);
                }catch(e){
                    cl.format("Callback error: ~s", e);
                }
            }
            this.removeCallback(id);
        }
    }

    process(update){
        if(!cl.typep(update, "PING") && !cl.typep(update, "PONG"))
            cl.format("[Lichat] Update:~s",update);
        if(cl.typep(update, "UPDATE-FAILURE"))
            this.processCallbacks(update["update-id"], update);
        else
            this.processCallbacks(update.id, update);
        if(!this.maybeCallInternalHandler(update.type, update)){
            for(let s of cl.classOf(update).superclasses){
                if(this.maybeCallInternalHandler(s.className, update))
                    break;
            }
        }
        if(!this.maybeCallHandler(update.type, update)){
            for(let s of cl.classOf(update).superclasses){
                if(this.maybeCallHandler(s.className, update))
                    break;
            }
        }
        return this;
    }

    maybeCallInternalHandler(type, update){
        if(this._internalHandlers[type]){
            this._internalHandlers[type](update);
            return true;
        }
        return false;
    }

    addInternalHandler(update, handler){
        this._internalHandlers[update] = handler;
        return this;
    }

    removeInternalHandler(update){
        delete this._internalHandlers[update];
        return this;
    }

    maybeCallHandler(type, update){
        if(this._handlers[type]){
            this._handlers[type](update);
            return true;
        }
        return false;
    }

    addHandler(update, handler){
        this._handlers[update] = handler;
        return this;
    }

    removeHandler(update){
        delete this._handlers[update];
        return this;
    }

    addCallback(id, handler){
        // FIXME: Add timeout mechanism
        if(!this._idCallbacks[id]){
            this._idCallbacks[id] = [handler];
        }else{
            this._idCallbacks[id].push(handler);
        }
        return this;
    }

    removeCallback(id, handler){
        if(handler && this._idCallbacks[id])
            this._idCallbacks[id] = this._idCallbacks[id].filter(item => item !== handler);
        else
            delete this._idCallbacks[id];
        return this;
    }

    get icon(){
        if(this.servername) return this.primaryChannel.icon;
        else return EmptyIcon;
    }

    get primaryChannel(){
        if(this.servername)
            return this.getChannel(this.servername);
        else
            return null;
    }

    getChannel(name){
        let channel = this.channels[name.toLowerCase()];
        if(channel === undefined){
            channel = new LichatChannel(name, this);
            this.channels[name.toLowerCase()] = channel;
        }
        return channel;
    }

    get user(){
        if(this.username)
            return this.getUser(this.username);
        else
            return null;
    }

    getUser(name){
        let user = this.users[name.toLowerCase()];
        if(user === undefined){
            user = new LichatUser(name, this);
            this.users[name.toLowerCase()] = user;
        }
        return user;
    }

    addEmote(emote){
        let name = emote["name"].toLowerCase().replace(/^:|:$/g,"");
        let channel = emote["channel"];

        if(emote["payload"]){
            let emote = {
                contentType: emote["content-type"],
                payload: emote["payload"],
                name: emote["name"]
            };
            getChannel(channel).emotes[name] = emote;
        }else{
            delete getChannel(channel).emotes[name];
        }
        return emote;
    }

    isAvailable(name){
        return cl.find(name, this.availableExtensions);
    }
};
class LichatUI{
    constructor(el){
        this.clients = {};
        this.currentChannel = null;
        this.app = new Vue({
            el: el || '.client',
            data: this
        });

        this.addClient(new LichatClient({
            name: "TyNET",
            hostname: "chat.tymoon.eu",
            ssl: true
        }));
    }

    addClient(client){
        Vue.set(this.clients, client.name, client);
        client.openConnection();
        return client;
    }
}
